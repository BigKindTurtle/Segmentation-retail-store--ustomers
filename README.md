# Описание проекта анализа лояльности клиентов

## 1. Основные цели и задачи проекта

**Главная цель:** Разработать комплексную систему анализа и оценки лояльности клиентов торговой сети на основе исторических данных о покупках.

**Ключевые задачи:**

- **Построение индекса лояльности** — создание многокомпонентного показателя (0-100 баллов), объединяющего RFM-метрики, лояльность к бренду и разнообразие покупок
- **Сегментация клиентов** — классификация покупателей на группы: активные сторонники, регулярные клиенты, перспективные, уходящие, спящие и новые
- **Прогнозирование оттока** — выявление клиентов с риском прекращения покупок через расчет churn score и определение уровня риска (низкий/средний/высокий/критический)
- **Анализ поведенческих паттернов** — изучение частоты покупок, трат, временных предпочтений, лояльности к собственному бренду магазина
- **Выявление аномалий** — обнаружение клиентов с нетипичными паттернами поведения
- **Визуализация результатов** — создание наглядных графиков распределений, корреляций и профилей сегментов

---

## 2. Краткая информация о данных

**Источник:** Excel-файл `Данные для анализа.xlsx`, конвертированный в CSV-формат.

**Структура датасета (12 колонок):**

| Поле | Описание | Тип данных |
|------|----------|------------|
| `client_id` | Уникальный идентификатор клиента | Целое число |
| `purchase_datetime` | Дата и время покупки | Datetime (формат: dd.mm.yyyy HH:MM:SS) |
| `store_name` | Название магазина | Строка |
| `product_name` | Название товара | Строка |
| `quantity` | Количество единиц товара | Число |
| `price` | Базовая цена товара | Число (руб) |
| `discount` | Размер скидки | Число (руб) |
| `is_weighted` | Флаг весового товара | Булево (да/нет) |
| `weight_kg` | Вес в килограммах | Число |
| `price_per_kg` | Цена за килограмм | Число |
| `is_food` | Флаг продукта питания | Булево |
| `is_own_brand` | Флаг собственного бренда | Булево (0/1) |

**Характеристики данных:**
- Гранулярность: уровень отдельных товарных позиций в чеке
- Временной диапазон: определяется содержимым файла
- Рассчитываемые поля: `final_price` (цена после скидки), `item_amount` (стоимость позиции)

---

## 3. Этапы работы над проектом

### **Этап 1: Подготовка данных**
- Конвертация Excel → CSV для оптимизации обработки
- Переименование колонок на понятные английские названия
- Парсинг дат и времени, типизация числовых полей
- Удаление дубликатов и обработка пропущенных значений (заполнение скидок нулями)
- Расчет производных метрик: итоговая цена, стоимость позиции

### **Этап 2: Расчет метрик клиентов** (класс `MetricsCalculator`)
Для каждого клиента вычисляется **40+ метрик** в 9 категориях:

**А. Частота покупок:**
- Количество уникальных дней с покупками
- Число транзакций, среднее количество товаров в чеке
- Средний интервал между покупками, его стандартное отклонение
- Тренд частоты (сравнение двух половин периода)

**Б. Актуальность (Recency):**
- Дней с последней покупки
- Период активности (от первой до последней покупки)
- Покупки за последние 3 месяца

**В. Денежная ценность (Monetary):**
- Средний чек, общие траты, минимальный/максимальный чек
- Стандартное отклонение чеков, средняя цена товара
- Тренд трат (линейная регрессия), изменение уровня расходов
- Средний месячный бюджет

**Г. Лояльность бренду:**
- Процент товаров собственного бренда, траты на них
- Уникальные товары бренда, частота их покупки
- Тренд лояльности к бренду

**Д. Разнообразие:**
- Уникальные категории/товары
- Индекс Шеннона (энтропия выбора)
- Индекс концентрации Херфиндаля

**Е. Временные паттерны:**
- Доля покупок утром/днем/вечером/в выходные
- Разнообразие дней недели, регулярность

**Ж. Поведение по магазинам:**
- Количество посещенных магазинов
- Лояльность основному магазину

**З. Использование скидок:**
- Частота участия в акциях
- Средняя скидка в рублях и процентах

**И. Характеристики корзины:**
- Средний размер и стоимость корзины
- Коэффициент вариации размера

### **Этап 3: Построение индекса лояльности** (класс `LoyaltyIndexBuilder`)
Комплексный индекс (0-100 баллов) из 5 компонентов:
- **Recency Score** (25 баллов) — свежесть последней покупки
- **Frequency Score** (25 баллов) — интенсивность покупок
- **Monetary Score** (25 баллов) — объем трат
- **Brand Loyalty Score** (15 баллов) — покупка товаров собственного бренда + тренд
- **Diversity Score** (10 баллов) — разнообразие ассортимента

### **Этап 4: Сегментация клиентов**
Классификация на 6 сегментов на основе RFM-метрик и индекса лояльности:
- **Активные сторонники** — высокая лояльность, частые недавние покупки
- **Регулярные клиенты** — стабильные покупатели
- **Перспективные клиенты** — средняя активность с потенциалом роста
- **Уходящие сторонники** — раньше были активны, сейчас давно нет покупок
- **Спящие/Утратившие** — неактивны длительное время
- **Новые клиенты** — не попадают в другие категории

### **Этап 5: Анализ риска оттока** (класс `ChurnAnalysis`)
Расчет **Churn Score** (0-1) на основе 4 факторов:
- Высокий recency (+0.3)
- Негативный тренд частоты (+0.3)
- Падение трат (+0.2)
- Низкая лояльность (+0.2)

Классификация риска: Низкий / Средний / Высокий / Критический

### **Этап 6: Визуализация** (класс `VisualizationEngine`)
Создание 3 наборов графиков (10 визуализаций):
- **Распределение лояльности:** гистограмма, boxplot по сегментам, корреляционная матрица, RFM scatter plot
- **Анализ сегментов:** pie chart, boxplot чеков, частота, recency, лояльность бренду, разнообразие
- **Анализ оттока:** распределение рисков, связь churn-loyalty, профили групп риска, churn по сегментам

### **Этап 7: Расширенная аналитика** (класс `AdvancedAnalytics`)
- **PCA** — снижение размерности для выявления скрытых паттернов
- **K-means** — альтернативная кластеризация клиентов
- **Isolation Forest** — обнаружение аномальных паттернов (5% клиентов)
- **Корреляционный анализ** — определение факторов, влияющих на лояльность

### **Этап 8: Генерация отчетов** (класс `ReportGenerator`)
Создание итоговых материалов:
- **Executive Summary** — текстовый отчет с ключевыми показателями
- **CSV-файлы:** полные метрики, ключевые метрики, обогащенные транзакции
- **JSON-отчет** — статистика и описание метрик
- **Визуализации** — графики в формате PNG (300 DPI)

---

## Технологический стек

**Библиотеки:**
- `pandas` — обработка данных
- `numpy` — математические операции
- `matplotlib`, `seaborn` — визуализация
- `scikit-learn` — машинное обучение (PCA, K-means, Isolation Forest, StandardScaler)
- `scipy` — статистика
- `json`, `pathlib` — работа с файлами

**Архитектура:** Объектно-ориентированный подход с разделением на модули (загрузка, метрики, индексы, сегментация, отток, визуализация, аналитика, отчеты)
